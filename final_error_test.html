<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆé”™è¯¯ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .success {
            border-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        #error-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æœ€ç»ˆé”™è¯¯ä¿®å¤éªŒè¯</h1>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯æ‰€æœ‰JavaScripté”™è¯¯æ˜¯å¦å·²ç»å®Œå…¨ä¿®å¤ã€‚</p>
        
        <div class="test-item" id="test-1">
            <h3>æµ‹è¯•1: DOMå…ƒç´ å®‰å…¨è®¿é—®</h3>
            <button class="btn" onclick="test1()">è¿è¡Œæµ‹è¯•</button>
            <div id="result-1">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item" id="test-2">
            <h3>æµ‹è¯•2: äº‹ä»¶ç›‘å¬å™¨å®‰å…¨ç»‘å®š</h3>
            <button class="btn" onclick="test2()">è¿è¡Œæµ‹è¯•</button>
            <div id="result-2">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item" id="test-3">
            <h3>æµ‹è¯•3: å˜é‡å®‰å…¨è®¿é—®</h3>
            <button class="btn" onclick="test3()">è¿è¡Œæµ‹è¯•</button>
            <div id="result-3">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item" id="test-4">
            <h3>æµ‹è¯•4: é¡µé¢åŠŸèƒ½å®Œæ•´æ€§</h3>
            <button class="btn" onclick="test4()">è¿è¡Œæµ‹è¯•</button>
            <div id="result-4">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item">
            <h3>ç»¼åˆæµ‹è¯•</h3>
            <button class="btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="test-item">
            <h3>é”™è¯¯ç›‘æ§æ—¥å¿—</h3>
            <div id="error-log">ç­‰å¾…ç›‘æ§å¼€å§‹...</div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // é”™è¯¯ç›‘æ§
        let errorCount = 0;
        const originalError = console.error;
        const originalLog = console.log;
        
        function logToUI(type, message) {
            const log = document.getElementById('error-log');
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${type}: ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // é‡å†™console.erroræ¥æ•è·é”™è¯¯
        console.error = function(...args) {
            originalError.apply(console, args);
            errorCount++;
            logToUI('ERROR', args.join(' '));
        };
        
        // é‡å†™console.logæ¥è®°å½•æ—¥å¿—
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToUI('LOG', args.join(' '));
        };
        
        // æ•è·æœªå¤„ç†çš„é”™è¯¯
        window.addEventListener('error', function(e) {
            errorCount++;
            logToUI('UNCAUGHT ERROR', `${e.filename}:${e.lineno} - ${e.message}`);
        });
        
        // æ•è·Promise rejection
        window.addEventListener('unhandledrejection', function(e) {
            errorCount++;
            logToUI('UNHANDLED REJECTION', e.reason);
        });
        
        function updateResult(testId, message, type = 'success') {
            const result = document.getElementById(`result-${testId}`);
            const testItem = document.getElementById(`test-${testId}`);
            result.textContent = message;
            testItem.className = `test-item ${type}`;
        }
        
        function test1() {
            console.log('å¼€å§‹æµ‹è¯•1: DOMå…ƒç´ å®‰å…¨è®¿é—®');
            
            try {
                // æµ‹è¯•å¯èƒ½ä¸å­˜åœ¨çš„å…ƒç´ 
                const elements = [
                    'chatInput',
                    'uploadArea',
                    'reverseTimeline',
                    'emissionCards',
                    'suggestionsContent',
                    'startAnalysis',
                    'aiSupplement',
                    'uploadedFiles'
                ];
                
                let safeAccess = 0;
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        // æµ‹è¯•æ“ä½œ
                        if (element.style) element.style.display;
                        if (element.innerHTML !== undefined) element.innerHTML;
                        if (element.disabled !== undefined) element.disabled;
                        safeAccess++;
                    }
                });
                
                updateResult(1, `âœ… DOMè®¿é—®æµ‹è¯•é€šè¿‡ - ${safeAccess}/${elements.length}ä¸ªå…ƒç´ å®‰å…¨è®¿é—®`, 'success');
            } catch (error) {
                updateResult(1, `âŒ DOMè®¿é—®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function test2() {
            console.log('å¼€å§‹æµ‹è¯•2: äº‹ä»¶ç›‘å¬å™¨å®‰å…¨ç»‘å®š');
            
            try {
                // æ¨¡æ‹Ÿäº‹ä»¶ç»‘å®šæµ‹è¯•
                const testElements = ['chatInput', 'uploadArea', 'aiModal'];
                let successCount = 0;
                
                testElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        // æµ‹è¯•æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                        const testHandler = function() {};
                        element.addEventListener('click', testHandler);
                        element.removeEventListener('click', testHandler);
                        successCount++;
                    }
                });
                
                updateResult(2, `âœ… äº‹ä»¶ç›‘å¬å™¨æµ‹è¯•é€šè¿‡ - ${successCount}ä¸ªå…ƒç´ äº‹ä»¶ç»‘å®šæ­£å¸¸`, 'success');
            } catch (error) {
                updateResult(2, `âŒ äº‹ä»¶ç›‘å¬å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function test3() {
            console.log('å¼€å§‹æµ‹è¯•3: å˜é‡å®‰å…¨è®¿é—®');
            
            try {
                // æµ‹è¯•å˜é‡å®‰å…¨è®¿é—®
                const hasAcceptedTest = typeof hasAcceptedSuggestions !== 'undefined' ? hasAcceptedSuggestions : false;
                const analysisDataTest = typeof analysisData !== 'undefined' ? analysisData : null;
                const uploadedFilesTest = typeof uploadedFiles !== 'undefined' ? uploadedFiles : [];
                
                updateResult(3, 'âœ… å˜é‡è®¿é—®æµ‹è¯•é€šè¿‡ - æ‰€æœ‰å˜é‡å®‰å…¨è®¿é—®', 'success');
            } catch (error) {
                updateResult(3, `âŒ å˜é‡è®¿é—®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function test4() {
            console.log('å¼€å§‹æµ‹è¯•4: é¡µé¢åŠŸèƒ½å®Œæ•´æ€§');
            
            try {
                // æµ‹è¯•å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
                const functions = [
                    'switchModule',
                    'ensureScrumPlanReady',
                    'renderTimeline',
                    'renderEmissionCards',
                    'setupEventListeners',
                    'setupFileUpload',
                    'showAISupplementSection'
                ];
                
                let existingFunctions = 0;
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        existingFunctions++;
                    }
                });
                
                if (existingFunctions === functions.length) {
                    updateResult(4, `âœ… åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•é€šè¿‡ - ${existingFunctions}/${functions.length}ä¸ªå…³é”®å‡½æ•°å­˜åœ¨`, 'success');
                } else {
                    updateResult(4, `âš ï¸ åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•éƒ¨åˆ†é€šè¿‡ - ${existingFunctions}/${functions.length}ä¸ªå…³é”®å‡½æ•°å­˜åœ¨`, 'warning');
                }
            } catch (error) {
                updateResult(4, `âŒ åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function runAllTests() {
            console.log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            errorCount = 0;
            
            setTimeout(() => test1(), 100);
            setTimeout(() => test2(), 200);
            setTimeout(() => test3(), 300);
            setTimeout(() => test4(), 400);
            
            setTimeout(() => {
                if (errorCount === 0) {
                    logToUI('SUMMARY', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼Œæœªå‘ç°JavaScripté”™è¯¯ï¼');
                } else {
                    logToUI('SUMMARY', `âš ï¸ æµ‹è¯•å®Œæˆï¼Œå‘ç° ${errorCount} ä¸ªé”™è¯¯`);
                }
            }, 1000);
        }
        
        function clearLog() {
            document.getElementById('error-log').textContent = 'æ—¥å¿—å·²æ¸…ç©º...\n';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logToUI('INIT', 'é”™è¯¯ä¿®å¤éªŒè¯é¡µé¢å·²åŠ è½½');
            logToUI('INIT', 'å¼€å§‹é”™è¯¯ç›‘æ§...');
            
            // å»¶è¿Ÿè¿è¡Œåˆå§‹æµ‹è¯•
            setTimeout(() => {
                logToUI('INIT', 'è‡ªåŠ¨è¿è¡Œåˆå§‹æ£€æŸ¥...');
                runAllTests();
            }, 1000);
        });
    </script>
</body>
</html>
